"use strict";(self.webpackChunkcdp_docs=self.webpackChunkcdp_docs||[]).push([[1034],{3905:(e,t,l)=>{l.d(t,{Zo:()=>p,kt:()=>c});var a=l(7294);function r(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}function n(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),l.push.apply(l,a)}return l}function s(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?n(Object(l),!0).forEach((function(t){r(e,t,l[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):n(Object(l)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))}))}return e}function i(e,t){if(null==e)return{};var l,a,r=function(e,t){if(null==e)return{};var l,a,r={},n=Object.keys(e);for(a=0;a<n.length;a++)l=n[a],t.indexOf(l)>=0||(r[l]=e[l]);return r}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)l=n[a],t.indexOf(l)>=0||Object.prototype.propertyIsEnumerable.call(e,l)&&(r[l]=e[l])}return r}var o=a.createContext({}),f=function(e){var t=a.useContext(o),l=t;return e&&(l="function"==typeof e?e(t):s(s({},t),e)),l},p=function(e){var t=f(e.components);return a.createElement(o.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var l=e.components,r=e.mdxType,n=e.originalType,o=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=f(l),m=r,c=u["".concat(o,".").concat(m)]||u[m]||d[m]||n;return l?a.createElement(c,s(s({ref:t},p),{},{components:l})):a.createElement(c,s({ref:t},p))}));function c(e,t){var l=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var n=l.length,s=new Array(n);s[0]=m;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i[u]="string"==typeof e?e:r,s[1]=i;for(var f=2;f<n;f++)s[f]=l[f];return a.createElement.apply(null,s)}return a.createElement.apply(null,l)}m.displayName="MDXCreateElement"},4845:(e,t,l)=>{l.r(t),l.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>d,frontMatter:()=>n,metadata:()=>i,toc:()=>f});var a=l(7462),r=(l(7294),l(3905));const n={sidebar_position:2,tags:["Active"]},s="SQLFluff",i={unversionedId:"program_overview/practitioner/guides/sqlfluff",id:"program_overview/practitioner/guides/sqlfluff",title:"SQLFluff",description:"Background",source:"@site/docs/program_overview/practitioner/guides/sqlfluff.md",sourceDirName:"program_overview/practitioner/guides",slug:"/program_overview/practitioner/guides/sqlfluff",permalink:"/doc/docs/program_overview/practitioner/guides/sqlfluff",draft:!1,editUrl:"https://github.com/cdp-ucsc/doc/blob/main/cdp-docs/docs/program_overview/practitioner/guides/sqlfluff.md",tags:[{label:"Active",permalink:"/doc/docs/tags/active"}],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,tags:["Active"]},sidebar:"documentationSidebar",previous:{title:"SQL Style Guide",permalink:"/doc/docs/program_overview/practitioner/guides/sql_style_guide"},next:{title:"Additional Resources",permalink:"/doc/docs/program_overview/practitioner/guides/additional_resources"}},o={},f=[{value:"Background",id:"background",level:3},{value:"SQLFLuff rules used in the .sqlfluff config in UCSC dbt project",id:"sqlfluff-rules-used-in-the-sqlfluff-config-in-ucsc-dbt-project",level:3},{value:"How to use sqlfluff config in your project",id:"how-to-use-sqlfluff-config-in-your-project",level:3},{value:"please use the versions that are in the requirements.txt e.g:",id:"please-use-the-versions-that-are-in-the-requirementstxt-eg",level:4},{value:"cli examples:",id:"cli-examples",level:4}],p={toc:f},u="wrapper";function d(e){let{components:t,...l}=e;return(0,r.kt)(u,(0,a.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"sqlfluff"},"SQLFluff"),(0,r.kt)("h3",{id:"background"},"Background"),(0,r.kt)("p",null,"SQLFluff is a dialect-flexible and configurable SQL linter. Designed with ELT applications in mind, SQLFluff also works with Jinja templating and dbt. SQLFluff will auto-fix most linting errors, allowing you to focus your time on what matters."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://towardsdatascience.com/sqlfluff-the-linter-for-modern-sql-8f89bd2e9117"},"Roles")," of a linting tool are to enforce cosmetic rules and prevent code smells."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("em",{parentName:"p"},'"Code bases without a consistent style are hard to read and work with because of their unpredictable structure....\nBeyond \u201cugly\u201d code, there is another category of \u201cproblematic\u201d code. Code that isn\u2019t invalid per say, but might indicate an issue in the logic." - Daniel Mateus Pires, Towards Data Science'))),(0,r.kt)("p",null,"Use ",(0,r.kt)("a",{parentName:"p",href:"https://docs.sqlfluff.com/en/stable/"},"SQLFluff")," to enforce these rules."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/sqlfluff/sqlfluff#readme"},"Source Reference")),(0,r.kt)("h3",{id:"sqlfluff-rules-used-in-the-sqlfluff-config-in-ucsc-dbt-project"},"SQLFLuff rules used in the .sqlfluff config in UCSC dbt project"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"SQL Style Guide Rule")),(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"Rule Code")),(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"SQLFluff Fix compatible")),(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"SQLFluff Default Configuration")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Use trailing commas"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#sqlfluff.rules.sphinx.Rule_LT04"},"LT04")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Indents should be four spaces ",(0,r.kt)("br",null),"(except for predicates, which should line up with the where keyword)"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#sqlfluff.rules.sphinx.Rule_LT02"},"LT02")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Lines of SQL should be no longer than 120 characters"),(0,r.kt)("td",{parentName:"tr",align:"left"},"max_line_length"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Use all lowercase unless a specific scenario needs you to do otherwise. ",(0,r.kt)("br",null),"This means that keywords, field names, function names, and file names should all be lowercased."),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#sqlfluff.rules.sphinx.Rule_CP01"},"CP01"),",",(0,r.kt)("br",null)," ",(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#sqlfluff.rules.sphinx.Rule_CP02"},"CP02"),", ",(0,r.kt)("br",null)," ",(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#sqlfluff.rules.sphinx.Rule_CP03"},"CP03")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Always use the ",(0,r.kt)("inlineCode",{parentName:"td"},"as")," keyword when aliasing columns, expressions, and tables."),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#sqlfluff.rules.sphinx.Rule_AL01"},"AL01"),", ",(0,r.kt)("br",null)," ",(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#sqlfluff.rules.sphinx.Rule_AL02"},"AL02")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Grouping by column numbers is preferred ",(0,r.kt)("br",null)," over grouping by column names/aliases (eg. group by 1, 2) ",(0,r.kt)("br",null),"Note that if you are grouping by more than a few columns, ",(0,r.kt)("br",null),"it may be worth revisiting your model design."),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#sqlfluff.rules.sphinx.Rule_AM06"},"AM06")),(0,r.kt)("td",{parentName:"tr",align:"left"},"No"),(0,r.kt)("td",{parentName:"tr",align:"left"},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Prefer union all to union"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#sqlfluff.rules.sphinx.Rule_AM02"},"AM02")),(0,r.kt)("td",{parentName:"tr",align:"left"},"N/A,",(0,r.kt)("br",null),"(not supported in snowflake)"),(0,r.kt)("td",{parentName:"tr",align:"left"},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Avoid using unnecessary table aliases, especially initialisms.",(0,r.kt)("br",null),' It\'s harder to understand what the table called "c" is ',(0,r.kt)("br",null),'compared to "customers".'),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#rule-AL07"},"AL07")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Be explicit with all join types ",(0,r.kt)("br",null)," for example use ",(0,r.kt)("inlineCode",{parentName:"td"},"inner join")," instead of just ",(0,r.kt)("inlineCode",{parentName:"td"},"join"),"."),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#rule-AM05"},"AM05")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"When joining multiple tables, always prefix the column names with the table name"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#rule-AM05"},"RF02")),(0,r.kt)("td",{parentName:"tr",align:"left"},"No"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Use single quotes for strings."),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#rule-CV10"},"CV10")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Don't use ",(0,r.kt)("inlineCode",{parentName:"td"},"using")," in joins."),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#rule-STO7"},"ST07")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Start each CTE on its own line, Use a single blank line around CTEs to add visual separation"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#rule-LT07"},"LT07"),", ",(0,r.kt)("br",null)," ",(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#rule-LT08"},"LT08")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Don't end a line with an operator like ",(0,r.kt)("inlineCode",{parentName:"td"},"and"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"or"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"+"),", ",(0,r.kt)("code",null,"|","|")," etc"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#rule-LT03"},"LT03")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"If there is only one column expression, put it on the same line as select. ",(0,r.kt)("br",null)," If there are multiple column expressions, put each one on its own line (including the first one), indented one level more than select. ",(0,r.kt)("br",null)," If there is a ",(0,r.kt)("inlineCode",{parentName:"td"},"distinct")," qualifier, put it on the same line as ",(0,r.kt)("inlineCode",{parentName:"td"},"select"),"."),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#rule-LT09"},"LT09"),", ",(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#rule-LT10"},"LT10")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Don't put extra spaces inside of parentheses"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlfluff.com/en/stable/rules.html#rule-LT01"},"LT01")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes")))),(0,r.kt)("h3",{id:"how-to-use-sqlfluff-config-in-your-project"},"How to use sqlfluff config in your project"),(0,r.kt)("h4",{id:"please-use-the-versions-that-are-in-the-requirementstxt-eg"},"please use the versions that are in the ",(0,r.kt)("a",{parentName:"h4",href:"https://github.com/cdp-ucsc/dbt-pilot/blob/main/requirements.txt"},"requirements.txt")," e.g:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Install  SQLFluff ",(0,r.kt)("br",null),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"pip install -r requirements.txt "))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"there is a configured .sqlfluff in the root of the project, which follows the dbt sql style guide as closely as possible (there are some rules that are not able to be fixed) ",(0,r.kt)("br",null),"\n",(0,r.kt)("inlineCode",{parentName:"p"},".sqlfluff, .sqlfluffignore")))),(0,r.kt)("h4",{id:"cli-examples"},"cli examples:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"lint a specific file",(0,r.kt)("br",null),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"sqlfluff lint models/staging/setl/stg_dwh__setl_step_log.sql"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"lint all files in a directory",(0,r.kt)("br",null),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"sqlfluff lint models/staging/setl"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"sqlfluff fix a specific file (caution: this will make changes to your file)",(0,r.kt)("br",null),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"sqlfluff fix models/staging/setl/stg_dwh__setl_step_log.sql"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"sqlfluff fix files in specific directory (caution: this will make changes to all files)",(0,r.kt)("br",null),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"sqlfluff fix models/staging/setl")))))}d.isMDXComponent=!0}}]);