"use strict";(self.webpackChunkcdp_docs=self.webpackChunkcdp_docs||[]).push([[547],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),d=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(i.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=d(n),u=r,g=m["".concat(i,".").concat(u)]||m[u]||p[u]||o;return n?a.createElement(g,l(l({ref:t},c),{},{components:n})):a.createElement(g,l({ref:t},c))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=u;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[m]="string"==typeof e?e:r,l[1]=s;for(var d=2;d<o;d++)l[d]=n[d];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4025:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var a=n(7462),r=(n(7294),n(3905));const o={description:"Documentation for CDP's individual dbt projects.",sidebar_position:1},l="dbt Project Modeling Guide",s={unversionedId:"program_overview/practitioner/guides/enterprise_modeling_guide/dbt_project_modeling_guide",id:"program_overview/practitioner/guides/enterprise_modeling_guide/dbt_project_modeling_guide",title:"dbt Project Modeling Guide",description:"Documentation for CDP's individual dbt projects.",source:"@site/docs/program_overview/practitioner/guides/enterprise_modeling_guide/dbt_project_modeling_guide.md",sourceDirName:"program_overview/practitioner/guides/enterprise_modeling_guide",slug:"/program_overview/practitioner/guides/enterprise_modeling_guide/dbt_project_modeling_guide",permalink:"/doc/docs/program_overview/practitioner/guides/enterprise_modeling_guide/dbt_project_modeling_guide",draft:!1,editUrl:"https://github.com/cdp-ucsc/doc/blob/main/cdp-docs/docs/program_overview/practitioner/guides/enterprise_modeling_guide/dbt_project_modeling_guide.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{description:"Documentation for CDP's individual dbt projects.",sidebar_position:1},sidebar:"documentationSidebar",previous:{title:"Enterprise Modeling Guides",permalink:"/doc/docs/category/enterprise-modeling-guides"},next:{title:"dbt Mesh Modeling Guide",permalink:"/doc/docs/program_overview/practitioner/guides/enterprise_modeling_guide/dbt_mesh_modeling_guide"}},i={},d=[{value:"dbt_project_name/",id:"dbt_project_name",level:2},{value:"Template Repo",id:"template-repo",level:3},{value:"dbt Project",id:"dbt-project",level:3},{value:"Different Project Properties and Configurations (YAMLs)",id:"different-project-properties-and-configurations-yamls",level:3},{value:"dbt_project.yml",id:"dbt_projectyml",level:4},{value:"packages.yml",id:"packagesyml",level:4},{value:"properties.yml",id:"propertiesyml",level:4},{value:"dbt_project_name/analyses/",id:"dbt_project_nameanalyses",level:2},{value:"dbt_project_name/data/",id:"dbt_project_namedata",level:2},{value:"dbt_project_name/dbt_packages/",id:"dbt_project_namedbt_packages",level:2},{value:"dbt_project_name/logs/",id:"dbt_project_namelogs",level:2},{value:"dbt_project_name/macros/",id:"dbt_project_namemacros",level:2},{value:"dbt_project_name/models/",id:"dbt_project_namemodels",level:2},{value:"Model Best Practices",id:"model-best-practices",level:3},{value:"models/base/",id:"modelsbase",level:3},{value:"RESOURCE NAMING CONVENTION",id:"resource-naming-convention",level:4},{value:"SOURCE.YML",id:"sourceyml",level:4},{value:"MODEL.YML",id:"modelyml",level:4},{value:"BASE LAYER BEST PRACTICES",id:"base-layer-best-practices",level:4},{value:"models/intermediate/",id:"modelsintermediate",level:3},{value:"models/legacy/",id:"modelslegacy",level:3},{value:"models/marts/",id:"modelsmarts",level:3},{value:"models/reverse_etl/",id:"modelsreverse_etl",level:3},{value:"RESOURCE NAMING CONVENTION",id:"resource-naming-convention-1",level:4},{value:"MODEL.YML",id:"modelyml-1",level:4},{value:"EXPOSURE.YML",id:"exposureyml",level:4},{value:"REVERSE ETL LAYER BEST PRACTICES",id:"reverse-etl-layer-best-practices",level:4},{value:"models/staging/",id:"modelsstaging",level:3},{value:"RESOURCE NAMING CONVENTION",id:"resource-naming-convention-2",level:4},{value:"SOURCE.YML",id:"sourceyml-1",level:4},{value:"MODEL.YML",id:"modelyml-2",level:4},{value:"STAGING LAYER BEST PRACTICES",id:"staging-layer-best-practices",level:4},{value:"dbt_project_name/seeds/",id:"dbt_project_nameseeds",level:2},{value:"dbt_project_name/snapshots/",id:"dbt_project_namesnapshots",level:2},{value:"dbt_project_name/target/",id:"dbt_project_nametarget",level:2},{value:"dbt_project_name/tests/",id:"dbt_project_nametests",level:2}],c={toc:d},m="wrapper";function p(e){let{components:t,...n}=e;return(0,r.kt)(m,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"dbt-project-modeling-guide"},"dbt Project Modeling Guide"),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"This page is a work in progress")),(0,r.kt)("h1",{id:"project-structure-and-guide"},"Project Structure and Guide"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\u2514\u2500\u2500\u2500 dbt_project_name\n     \u251c\u2500\u2500\u2500 .github\n     \u251c\u2500\u2500\u2500 analyses\n     \u251c\u2500\u2500\u2500 data\n     \u251c\u2500\u2500\u2500 dbt_packages\n     \u251c\u2500\u2500\u2500 logs\n     \u251c\u2500\u2500\u2500 macros\n     \u251c\u2500\u2500\u2500 models\n     \u2502    \u251c\u2500\u2500\u2500 base\n     \u2502    \u251c\u2500\u2500\u2500 intermediate\n     \u2502    \u251c\u2500\u2500\u2500 legacy\n     \u2502    \u251c\u2500\u2500\u2500 marts\n     \u2502    \u251c\u2500\u2500\u2500 reports\n     \u2502    \u2514\u2500\u2500\u2500 staging\n     \u251c\u2500\u2500\u2500 seeds\n     \u251c\u2500\u2500\u2500 snapshots\n     \u251c\u2500\u2500\u2500 target\n     \u251c\u2500\u2500\u2500 template\n     \u251c\u2500\u2500\u2500 tests\n     \u251c\u2500\u2500\u2500 .gitignore\n     \u251c\u2500\u2500\u2500 .sqlfluff\n     \u251c\u2500\u2500\u2500 .sqlfluffignore\n     \u251c\u2500\u2500\u2500 dbt_project.yml\n     \u251c\u2500\u2500\u2500 packages.yml\n     \u251c\u2500\u2500\u2500 README.md\n     \u2514\u2500\u2500\u2500 requirements.txt\n")),(0,r.kt)("p",null,"The naming convention of projects are:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[project]-analytics\n")),(0,r.kt)("p",null,"For example, the financial domain project is named ",(0,r.kt)("inlineCode",{parentName:"p"},"financial-analytics"),"."),(0,r.kt)("h2",{id:"dbt_project_name"},"dbt_project_name/"),(0,r.kt)("h3",{id:"template-repo"},"Template Repo"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\u2514\u2500\u2500\u2500 dbt_project_name\n     \u251c\u2500\u2500\u2500 .github\n     \u251c\u2500\u2500\u2500 ...\n     \u251c\u2500\u2500\u2500 template\n     \u251c\u2500\u2500\u2500 ...\n     \u251c\u2500\u2500\u2500 .gitignore\n     \u251c\u2500\u2500\u2500 .sqlfluff\n     \u251c\u2500\u2500\u2500 .sqlfluffignore\n     \u251c\u2500\u2500\u2500 ...\n     \u251c\u2500\u2500\u2500 packages.yml\n     \u251c\u2500\u2500\u2500 README.md\n     \u2514\u2500\u2500\u2500 requirements.txt\n")),(0,r.kt)("p",null,"The selected resources above are managed by the template repo, ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/cdp-ucsc/dbt-project-template"},"dbt-project-template"),". Therefore, the resources shared by all of the dbt projects are centrally managed. All dbt projects are created from the template repo."),(0,r.kt)("h3",{id:"dbt-project"},"dbt Project"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\u2514\u2500\u2500\u2500 dbt_project_name\n     \u251c\u2500\u2500\u2500 ...\n     \u251c\u2500\u2500\u2500 analyses\n     \u251c\u2500\u2500\u2500 data\n     \u251c\u2500\u2500\u2500 dbt_packages\n     \u251c\u2500\u2500\u2500 logs\n     \u251c\u2500\u2500\u2500 macros\n     \u251c\u2500\u2500\u2500 models\n     \u2502    \u251c\u2500\u2500\u2500 base\n     \u2502    \u251c\u2500\u2500\u2500 intermediate\n     \u2502    \u251c\u2500\u2500\u2500 legacy\n     \u2502    \u251c\u2500\u2500\u2500 marts\n     \u2502    \u251c\u2500\u2500\u2500 reports\n     \u2502    \u2514\u2500\u2500\u2500 staging\n     \u251c\u2500\u2500\u2500 seeds\n     \u251c\u2500\u2500\u2500 snapshots\n     \u251c\u2500\u2500\u2500 target\n     \u251c\u2500\u2500\u2500 ...\n     \u251c\u2500\u2500\u2500 tests\n     \u251c\u2500\u2500\u2500 ...\n     \u251c\u2500\u2500\u2500 dbt_project.yml\n     \u251c\u2500\u2500\u2500 ...\n")),(0,r.kt)("p",null,"The remaining resources are project specific and are not managed by the template repo."),(0,r.kt)("h3",{id:"different-project-properties-and-configurations-yamls"},"Different Project Properties and Configurations (YAMLs)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\u2514\u2500\u2500\u2500 dbt_project_name\n     \u251c\u2500\u2500\u2500 ...\n     \u251c\u2500\u2500\u2500 models\n     \u2502    \u251c\u2500\u2500\u2500 ...\n     \u2502    \u251c\u2500\u2500\u2500 \u2502    \u251c\u2500\u2500\u2500 properties.yml\n     \u2502    \u251c\u2500\u2500\u2500 ...\n     \u251c\u2500\u2500\u2500 ...\n     \u251c\u2500\u2500\u2500 dbt_project.yml\n     \u251c\u2500\u2500\u2500 packages.yml\n     \u251c\u2500\u2500\u2500 ...\n")),(0,r.kt)("p",null,"A dbt project uses YAML, ",(0,r.kt)("inlineCode",{parentName:"p"},".yml"),", files to store and specify properties and configurations for project resources and the project itself. dbt Labs has documentation regarding properties and configurations ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/reference/configs-and-properties"},"here"),"."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note that dbt Lab's documentation is versioned and to select the correct version when reviewing their documentation.")),(0,r.kt)("p",null,"The different type of YAMLs that can be found in a dbt project are ",(0,r.kt)("inlineCode",{parentName:"p"},"dbt_project.yml"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"packages.yml"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"properties.yml"),"."),(0,r.kt)("h4",{id:"dbt_projectyml"},"dbt_project.yml"),(0,r.kt)("p",null,"dbt Labs' project configuration documentation for the ",(0,r.kt)("inlineCode",{parentName:"p"},"dbt_project.yml")," can be found ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/reference/dbt_project.yml"},"here"),". CDP projects use the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/dbt-labs/dbt-core/blob/main/core/dbt/include/starter_project/dbt_project.yml"},(0,r.kt)("inlineCode",{parentName:"a"},"dbt_project.yml"))," that is generated during the ",(0,r.kt)("inlineCode",{parentName:"p"},"dbt init")," process and make modifications as necessary. A common area that may receive modifications is the models section. For example,"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"# In this example config, we tell dbt to build all models in the example/\n# directory as views. These settings can be overridden in the individual model\n# files using the `{{ config(...) }}` macro.\nmodels:\n  cdp_finance:\n    staging:\n      +materialized: view\n    intermediate:\n      +materialized: view\n    marts:\n      +materialized: table\n    reverse_etl:\n      +materialized: table\n      +schema: shared_data\n")),(0,r.kt)("p",null,"There is only one ",(0,r.kt)("inlineCode",{parentName:"p"},"dbt_project.yml")," in a dbt project."),(0,r.kt)("h4",{id:"packagesyml"},"packages.yml"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"packages.yml")," is where packages that should be made available for use in the dbt project are specified. There is only one ",(0,r.kt)("inlineCode",{parentName:"p"},"packages.yml")," in a dbt project. Note that the ",(0,r.kt)("inlineCode",{parentName:"p"},"packages.yml")," is managed by the template repo. "),(0,r.kt)("h4",{id:"propertiesyml"},"properties.yml"),(0,r.kt)("p",null,"Property YAML files can be named anything. What identifies a YAML file as a property YAML is the resource key and the property keys and values that follow. The following project resources can have property YAML files: models, seeds, snapshots, sources, analyses, exposures, and macros. There can be multiple ",(0,r.kt)("inlineCode",{parentName:"p"},"properties.yml")," files in a dbt project. The ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/reference/configs-and-properties"},"dbt Labs documentation")," on properties and configurations is very thorough and highly recommended for developers to review."),(0,r.kt)("p",null,"This document will build upon dbt Labs documentation and further discuss specific CDP standards for each project resource in its corresponding section."),(0,r.kt)("h2",{id:"dbt_project_nameanalyses"},"dbt_project_name/analyses/"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Documentation needed.")),(0,r.kt)("h2",{id:"dbt_project_namedata"},"dbt_project_name/data/"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Documentation needed.")),(0,r.kt)("h2",{id:"dbt_project_namedbt_packages"},"dbt_project_name/dbt_packages/"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Documentation needed.")),(0,r.kt)("h2",{id:"dbt_project_namelogs"},"dbt_project_name/logs/"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Documentation needed.")),(0,r.kt)("h2",{id:"dbt_project_namemacros"},"dbt_project_name/macros/"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Documentation needed.")),(0,r.kt)("h2",{id:"dbt_project_namemodels"},"dbt_project_name/models/"),(0,r.kt)("h3",{id:"model-best-practices"},"Model Best Practices"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The general naming convention for all models and fields should be singular.",(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("ul",{parentName:"blockquote"},(0,r.kt)("li",{parentName:"ul"},"If you had a dimension that held attributes for a student in a given term, would you call it \u201cdim_student_term\u201d, \u201cdim_student_terms\u201d, or \u201cdim_students_terms\u201d?"),(0,r.kt)("li",{parentName:"ul"},"Simplicity \u2013 singular is shorter and doesn\u2019t vary based on word (e.g., \u201cies\u201d, \u201ces\u201d, \u201cs\u201d)"),(0,r.kt)("li",{parentName:"ul"},"Coding Principals \u2013 in coding, entities are always singular (e.g., Public Class Inventory)"),(0,r.kt)("li",{parentName:"ul"},"English Language Learners \u2013 pluralization is difficult, e.g., \u201cinventory\u201d vs \u201cinventories\u201d")))),(0,r.kt)("li",{parentName:"ul"},"Use CTEs.",(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"A recognizable trait of dbt Lab's modeling style is their use of CTEs. We have adapted dbt Lab's use of CTEs. Commonly replacing subqueries with CTEs and utilizing CTEs to \"import\" models. New developers should review dbt's documentation on the topic of CTEs and existing CDP models."),(0,r.kt)("ul",{parentName:"blockquote"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.getdbt.com/terms/cte"},"Analytics Engineering Glossary: CTE in SQL")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.getdbt.com/best-practices/how-we-style/2-how-we-style-our-sql#import-ctes"},"'Import' CTEs")," vs ",(0,r.kt)("a",{parentName:"li",href:"https://docs.getdbt.com/best-practices/how-we-style/2-how-we-style-our-sql#functional-ctes"},"'Functional' CTEs")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://discourse.getdbt.com/t/why-the-fishtown-sql-style-guide-uses-so-many-ctes/1091"},"Why dbt Labs (Fishtown) SQL style guide uses so many CTEs")),(0,r.kt)("li",{parentName:"ul"},"[Add CDP example models]")))),(0,r.kt)("li",{parentName:"ul"},"Developers should prioritize modular, reusable, concise, and universal modeling.",(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("ul",{parentName:"blockquote"},(0,r.kt)("li",{parentName:"ul"},"Again, CTEs can be used to create modular and concise modeling."),(0,r.kt)("li",{parentName:"ul"},"Intermediate models can be used to create modular, reusable, and concise models."),(0,r.kt)("li",{parentName:"ul"},"Adhering to CDP's SQL style guide can create concise and universal models."))))),(0,r.kt)("h3",{id:"modelsbase"},"models/base/"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\u2514\u2500\u2500\u2500 dbt_project_name\n     \u251c\u2500\u2500\u2500 ...\n     \u251c\u2500\u2500\u2500 models\n     \u2502    \u2514\u2500\u2500\u2500 base\n               \u251c\u2500\u2500\u2500 source1\n               \u2502    \u251c\u2500\u2500\u2500 _base_source1__source.yml\n               \u2502    \u251c\u2500\u2500\u2500 _base_source1__model.yml\n               \u2502    \u251c\u2500\u2500\u2500 base_source1__model1.sql\n               \u2502    \u251c\u2500\u2500\u2500 ...\n               \u2502    \u2514\u2500\u2500\u2500 base_source1__modeln.yml\n               \u251c\u2500\u2500\u2500 ....\n               \u2514\u2500\u2500\u2500 sourcen\n     \u2502    \u251c\u2500\u2500\u2500 ...\n     \u251c\u2500\u2500\u2500 ...\n\n")),(0,r.kt)("p",null,"The base layer should be organized by source. Each base folder should contain a source yaml, model yaml, and base models."),(0,r.kt)("h4",{id:"resource-naming-convention"},"RESOURCE NAMING CONVENTION"),(0,r.kt)("p",null,"Source Property YAML:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"_base_[source]__source.yml\n")),(0,r.kt)("p",null,"Model Property YAML:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"_base_[source]__model.yml\n")),(0,r.kt)("p",null,"Base Model:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"base_[source]__model.sql\n")),(0,r.kt)("h4",{id:"sourceyml"},"SOURCE.YML"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"version: 2\nsources:\n    - name: source_name\n      tables:\n        - name: table_name\n")),(0,r.kt)("p",null,"CDP utilizes the source YAML as per dbt lab's documentation. Models declared at the base layer source should not be declared in the staging layer source."),(0,r.kt)("p",null,"See more source properties ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/reference/source-properties"},"here"),"."),(0,r.kt)("h4",{id:"modelyml"},"MODEL.YML"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"version: 2\nmodels:\n  - name:\n    description:\n")),(0,r.kt)("p",null,"Base layer models will be tested at the staging layer per the staging layer's practices."),(0,r.kt)("p",null,"See more model properties ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/reference/model-properties"},"here"),"."),(0,r.kt)("h4",{id:"base-layer-best-practices"},"BASE LAYER BEST PRACTICES"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The base layer should only be used on a case by case basis."),(0,r.kt)("li",{parentName:"ul"},"Base models should be materialized as a view."),(0,r.kt)("li",{parentName:"ul"},"Base models should not exclude any columns or rows from the source data. Except soft deletes should be excluded."),(0,r.kt)("li",{parentName:"ul"},"Base models should be used as the landing zone for semi-structure source data that needs to be parsed. (e.g. JSON data)"),(0,r.kt)("li",{parentName:"ul"},"Base models can be used if there is a need to retain the soft deleted records that are excluded in the staging layer. (e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"_fivetran_deleted = false"),")",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"This is a rare case. Double-check if this is the correct approach or ",(0,r.kt)("inlineCode",{parentName:"li"},"dbt snapshot")," should be used."))),(0,r.kt)("li",{parentName:"ul"},"Base models should be ",(0,r.kt)("inlineCode",{parentName:"li"},"ref()")," in the staging layer. ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"The staging model name should end in ",(0,r.kt)("inlineCode",{parentName:"li"},"_flattened")," if the base model was semi-structured data.")))),(0,r.kt)("h3",{id:"modelsintermediate"},"models/intermediate/"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Documentation needed.er")),(0,r.kt)("h3",{id:"modelslegacy"},"models/legacy/"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Documentation needed.")),(0,r.kt)("h3",{id:"modelsmarts"},"models/marts/"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Documentation needed.")),(0,r.kt)("h3",{id:"modelsreverse_etl"},"models/reverse_etl/"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\u2514\u2500\u2500\u2500 dbt_project_name\n     \u251c\u2500\u2500\u2500 ...\n     \u251c\u2500\u2500\u2500 models\n     \u2502    \u251c\u2500\u2500\u2500 ...\n     \u2502    \u251c\u2500\u2500\u2500 reverse_etl\n               \u251c\u2500\u2500\u2500 destination_system1\n               \u2502    \u251c\u2500\u2500\u2500 _retl_destination_system1_exposure.yml\n               \u2502    \u251c\u2500\u2500\u2500 _retl_destination_system1_model.yml\n               \u2502    \u251c\u2500\u2500\u2500 retl_destination_system1__model1.sql\n               \u2502    \u251c\u2500\u2500\u2500 retl_destination_system1__model2.sql\n               \u2502    \u251c\u2500\u2500\u2500 ...\n               \u2502    \u2514\u2500\u2500\u2500 retl_destination_system1__modeln.sql\n               \u251c\u2500\u2500\u2500 destination_system2\n               \u2502    \u251c\u2500\u2500\u2500 ...\n               \u251c\u2500\u2500\u2500 ...\n     \u2502    \u251c\u2500\u2500\u2500 ...\n     \u251c\u2500\u2500\u2500 ...\n")),(0,r.kt)("p",null,"The reverse ETL layer is organized by destination systems. Each destination system will have a model YAML and exposure YAML."),(0,r.kt)("h4",{id:"resource-naming-convention-1"},"RESOURCE NAMING CONVENTION"),(0,r.kt)("p",null,"Model Property YAML:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"_retl_[destination_system]_model.yml\n")),(0,r.kt)("p",null,"Exposure Property YAML:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"_retl_[destination_system]_exposure.yml\n")),(0,r.kt)("p",null,"Reverse ETL Model:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"retl_[destination_system]__[model_name].sql\n")),(0,r.kt)("h4",{id:"modelyml-1"},"MODEL.YML"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"version: 2\nmodels:\n  - name:\n    description: \n")),(0,r.kt)("p",null,"There is no set of standard tests recommended for reverse ETL models. Suggested tests are tests related to data integrity/formatting required by the reverse ETL tool Census and the destination system."),(0,r.kt)("p",null,"The model descriptions should detail the business requirements that the model is meeting for the specific destination system."),(0,r.kt)("p",null,"See more model properties ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/reference/model-properties"},"here"),"."),(0,r.kt)("h4",{id:"exposureyml"},"EXPOSURE.YML"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"version: 2\nexposures:\n  - name:\n    label:\n    description:\n    type:\n    maturity:\n    depends_on:\n    tags:\n    owner:\n      name:\n      email: \n")),(0,r.kt)("p",null,"All reverse ETL models should be referenced under an exposure's ",(0,r.kt)("inlineCode",{parentName:"p"},"depends_on")," key. Exposures are important to surface the destination system in the project DAG. "),(0,r.kt)("p",null,"See more exposure properties ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/reference/exposure-properties"},"here"),"."),(0,r.kt)("h4",{id:"reverse-etl-layer-best-practices"},"REVERSE ETL LAYER BEST PRACTICES"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reverse ETL models should not ",(0,r.kt)("inlineCode",{parentName:"li"},"ref()")," staging models. Ideally they ",(0,r.kt)("inlineCode",{parentName:"li"},"ref()")," mart models.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Beware of models referencing resources of different materializations (i.e. staging view vs mart table)."))),(0,r.kt)("li",{parentName:"ul"},"Reverse ETL models should extract business requirements/logic out of the reverse ETL tool so it can be managed in the dbt project.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Reverse etl tools can change. Managing the business requirements in the dbt project makes it easily transferrable. The dbt project also provides version management that is already integrated with CDP's workflow.")))),(0,r.kt)("h3",{id:"modelsstaging"},"models/staging/"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\u2514\u2500\u2500\u2500 dbt_project_name\n     \u251c\u2500\u2500\u2500 ...\n     \u251c\u2500\u2500\u2500 models\n     \u2502    \u251c\u2500\u2500\u2500 ...\n     \u2502    \u251c\u2500\u2500\u2500 staging\n               \u251c\u2500\u2500\u2500 source1\n               \u2502    \u251c\u2500\u2500\u2500 _stg_source1__source.yml\n               \u2502    \u251c\u2500\u2500\u2500 _stg_source1__model.yml\n               \u2502    \u251c\u2500\u2500\u2500 stg_source1__model1.sql\n               \u2502    \u251c\u2500\u2500\u2500 ...\n               \u2502    \u2514\u2500\u2500\u2500 stg_source1__modeln.yml\n               \u251c\u2500\u2500\u2500 source2\n               \u2502    \u251c\u2500\u2500\u2500 _stg_source2__schemaX_source.yml\n               \u2502    \u251c\u2500\u2500\u2500 _stg_source2__schemaY_source.yml\n               \u2502    \u251c\u2500\u2500\u2500 _stg_source2__schemaZ_source.yml\n               \u2502    \u251c\u2500\u2500\u2500 _stg_source2__model.yml\n               \u2502    \u251c\u2500\u2500\u2500 stg_source2__model1.sql\n               \u2502    \u251c\u2500\u2500\u2500 ...\n               \u2502    \u2514\u2500\u2500\u2500 stg_source2__modeln.yml\n               \u251c\u2500\u2500\u2500 ...\n     \u2502    \u251c\u2500\u2500\u2500 ...\n     \u251c\u2500\u2500\u2500 ...\n")),(0,r.kt)("p",null,"The staging layer is organized by source. A source can be further organized into separate source YAMLs for each schema if the source is comprised of multiple schemas. A single source will have a single model YAML regardless of the organization of source YAMLs."),(0,r.kt)("p",null,"See the ",(0,r.kt)("inlineCode",{parentName:"p"},"financial-analytics")," ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/cdp-ucsc/financial-analytics/tree/main/models/staging/"},"staging layer")," for an example."),(0,r.kt)("h4",{id:"resource-naming-convention-2"},"RESOURCE NAMING CONVENTION"),(0,r.kt)("p",null,"Source Property YAML:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"_stg_[source]__source.yml or `_stg_[source]__[schema]_source.yml\n")),(0,r.kt)("p",null,"Model Property YAML:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"_stg_[source]__model.yml\n")),(0,r.kt)("p",null,"Staging Model:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"}," stg_[source]__[source_table_name].sql\n")),(0,r.kt)("h4",{id:"sourceyml-1"},"SOURCE.YML"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"version: 2\nsources:\n    - name: source_name\n      meta:\n        soft_delete_columns:\n      tables:\n        - name: table_name\n          meta:\n            effective_type:\n            effective_date_col:\n            effective_sequence_col:\n            effective_sequence_order:\n            partition_columns:\n            columns:\n              - name: column_a\n                meta:\n                  casted_as: data_type\n                  renamed_as: new_name\n")),(0,r.kt)("p",null,"CDP utilizes the source YAML as per dbt lab's documentation. CDP also utilizes dbt's meta tag to declare additional information specific to CDP's staging process. Further information can be found ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/cdp-ucsc/cdp-ucsc-dbt-codegen/tree/staging-layer-macros/macros/cdp-ucsc-staging-layer"},"here"),"."),(0,r.kt)("p",null,"See more source properties ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/reference/source-properties"},"here"),"."),(0,r.kt)("h4",{id:"modelyml-2"},"MODEL.YML"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"version: 2\nmodels:\n  - name:\n    description:\n    tests:\n      - dbt_utils.unique_combination_of_columns:\n        combination_of_columns:\n          - column1\n          - column2\n          - ...\n      - dbt_expectations.expect_table_row_count_to_be_between:\n          min_value: 1\n")),(0,r.kt)("p",null,"All models at the staging layer must be tested for uniqueness and emptyness using the above tests."),(0,r.kt)("p",null,"See more model properties ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/reference/model-properties"},"here"),"."),(0,r.kt)("h4",{id:"staging-layer-best-practices"},"STAGING LAYER BEST PRACTICES"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Staging models should be materialized as views."),(0,r.kt)("li",{parentName:"ul"},"Staging models should not exclude any columns or rows from the source data. Except soft deletes should be excluded."),(0,r.kt)("li",{parentName:"ul"},"Staging models can include renamed fields.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"The new field name should be independent of business name/logic. More business friendly names can be declared in downstream layers. "))),(0,r.kt)("li",{parentName:"ul"},"Staging models can include data type conversions."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/cdp-ucsc/cdp-ucsc-dbt-codegen/tree/staging-layer-macros/macros/cdp-ucsc-staging-layer"},"CDP's staging macros")," should be used to generate models. The staging macros reflect the staging model's best practices.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"By utilizing CDP's staging macros, staging logic will be consistently managed across all of the dbt projects."),(0,r.kt)("li",{parentName:"ul"},"If a base model exists, the staging model should ",(0,r.kt)("inlineCode",{parentName:"li"},"ref()")," the base model and not be generated from CDP's staging macros.")))),(0,r.kt)("h2",{id:"dbt_project_nameseeds"},"dbt_project_name/seeds/"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Documentation needed.")),(0,r.kt)("h2",{id:"dbt_project_namesnapshots"},"dbt_project_name/snapshots/"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Documentation needed.")),(0,r.kt)("h2",{id:"dbt_project_nametarget"},"dbt_project_name/target/"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Documentation needed.")),(0,r.kt)("h2",{id:"dbt_project_nametests"},"dbt_project_name/tests/"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Documentation needed.")))}p.isMDXComponent=!0}}]);